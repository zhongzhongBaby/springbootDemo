<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.PosInfoDao">
    <!-- pos机管理查询-->
    <select id="findPosList" resultType="PosInfoVo">
        SELECT a.*,sys_dict.label AS posStatusLabel FROM (
        SELECT
        pos_info.id  AS id,
        pos_info.pos_number AS posNumber,
        pos_info.campus_id AS campusId ,
        pos_info.remarks AS remarks,
        pos_history.create_date AS updateDate,
        pos_history.remarks AS posStatus
        FROM
        pos_info
        LEFT JOIN pos_history ON pos_history.pos_number = pos_info.pos_number
        WHERE
        pos_info.del_flag = 0
        AND pos_history.create_date = ( SELECT Max(create_date) FROM pos_history WHERE pos_history.pos_number = pos_info.pos_number )
        <if test="posNumber != null and  posNumber != ''">
            AND pos_info.pos_number  LIKE CONCAT('%',#{posNumber},'%')
        </if>
        <if test="campusId != null and campusId != '' ">
            AND pos_info.campus_id=  #{campusId}
        </if>
        <if test="status != null and status != '' ">
            AND pos_history.remarks = #{status}
        </if>
        ) a
        LEFT JOIN sys_dict ON sys_dict.`value` = a.posStatus AND sys_dict.type='pos_status_type'
        <include refid="Page.pageWhere"></include>
    </select>


    <select id="findById" resultType="PosInfoVo">
        SELECT
        pos_info.id  AS id,
        pos_info.pos_number AS posNumber,
        pos_info.campus_id AS campusId ,
        pos_info.remarks AS remarks
        FROM
        pos_info
        WHERE
        id=#{id}
    </select>









</mapper>